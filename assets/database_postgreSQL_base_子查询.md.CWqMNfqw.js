import{_ as a,c as i,o as e,b3 as n}from"./chunks/framework.CatkIGlB.js";const o=JSON.parse('{"title":"PostgreSQL 子查询用法与实例","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/base/子查询.md","filePath":"database/postgreSQL/base/子查询.md","lastUpdated":1690289709000}'),l={name:"database/postgreSQL/base/子查询.md"};function t(p,s,h,k,d,r){return e(),i("div",null,[...s[0]||(s[0]=[n(`<h1 id="postgresql-子查询用法与实例" tabindex="-1">PostgreSQL 子查询用法与实例 <a class="header-anchor" href="#postgresql-子查询用法与实例" aria-label="Permalink to &quot;PostgreSQL 子查询用法与实例&quot;">​</a></h1><p>本文介绍了如何在 PostgreSQL 中使用子查询。</p><p>在 PostgreSQL 中，子查询是嵌套在另一个查询中的查询，也被称为内部查询。</p><p>通常情况下，我们会使用子查询构建更复杂的 SQL 语句。比如，您可以将子查询使用在 <code>EXISTS</code>, <code>IN</code>, <code>ANY</code>, <code>ALL</code> 等表达式中，也可以将子查询的结果直接和值比较。</p><h2 id="在-postgresql-exists-运算符中使用子查询" tabindex="-1">在 PostgreSQL EXISTS 运算符中使用子查询 <a class="header-anchor" href="#在-postgresql-exists-运算符中使用子查询" aria-label="Permalink to &quot;在 PostgreSQL EXISTS 运算符中使用子查询&quot;">​</a></h2><p><a href="/database/postgreSQL/base/EXISTS.html">PostgreSQL <code>EXISTS</code> 运算符</a>需要一个子查询作为操作数，以检查此子查询是否返回行。</p><p>比如，要从 <a href="/database/sakila/语言表.html">Sakila 数据库中的 <code>language</code> 表</a>查找那些在 <a href="/database/sakila/影片表.html"><code>film</code></a>表中用到的语言，您可以使用如下语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> language</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film.language_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> language.language_id</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  );</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> language_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">         name</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">         |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">     last_update</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">-------------+----------------------+---------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">           1</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> English</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">              |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> 2006-02-15</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> 05:02:19</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">1</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> row</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">)</span></span></code></pre></div><p>在上面的语句中，下面的查询就是一个子查询：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film.language_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> language.language_id</span></span></code></pre></div><h2 id="在-postgresql-in-运算符中使用子查询" tabindex="-1">在 PostgreSQL IN 运算符中使用子查询 <a class="header-anchor" href="#在-postgresql-in-运算符中使用子查询" aria-label="Permalink to &quot;在 PostgreSQL IN 运算符中使用子查询&quot;">​</a></h2><p>PostgreSQL <code>IN</code> 运算符也需要一个集合作为操作数，因此您也可以使用 子查询 作为 <code>IN</code> 运算符右侧的操作数。</p><p>比如，您可以使用如下带有 <code>IN</code> 运算符和子查询的语句达到上面的目的：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> language</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> language_id </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">in</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    SELECT DISTINCT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> language_id</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  );</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> language_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">         name</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">         |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">     last_update</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">-------------+----------------------+---------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">           1</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> English</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">              |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> 2006-02-15</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> 05:02:19</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">1</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> row</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">)</span></span></code></pre></div><p>这里，下面的语句就是一个子查询，以查询出所有的影片用到的 <code>language_id</code>:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT DISTINCT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> language_id</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span></code></pre></div><h2 id="将子查询直接和值进行比较" tabindex="-1">将子查询直接和值进行比较 <a class="header-anchor" href="#将子查询直接和值进行比较" aria-label="Permalink to &quot;将子查询直接和值进行比较&quot;">​</a></h2><p>比如，要计算租金高于平均租金的影片的数量，您可以使用一下语句实现：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> count</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">*</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> rental_rate </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    SELECT</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> avg</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(rental_rate)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  );</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> count</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">-------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">   659</span></span></code></pre></div><p>这里，我们使用了下面的子查询计算影片的平均租金：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> avg</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(rental_rate)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> film</span></span></code></pre></div><p>然后，将租金 <code>rental_rate</code> 和上面子查询的结果进行比较，从而得到租金比平均租金大的影片的数量。</p><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>PostgreSQL 子查询可以帮助您构建更复杂的 SQL 语句。</p>`,27)])])}const c=a(l,[["render",t]]);export{o as __pageData,c as default};
