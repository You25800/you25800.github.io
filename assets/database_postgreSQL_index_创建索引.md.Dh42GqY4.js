import{_ as i,c as a,o as e,b3 as t}from"./chunks/framework.CatkIGlB.js";const c=JSON.parse('{"title":"PostgreSQL 创建索引","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/index/创建索引.md","filePath":"database/postgreSQL/index/创建索引.md","lastUpdated":1689834507000}'),l={name:"database/postgreSQL/index/创建索引.md"};function h(n,s,p,d,k,r){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="postgresql-创建索引" tabindex="-1">PostgreSQL 创建索引 <a class="header-anchor" href="#postgresql-创建索引" aria-label="Permalink to &quot;PostgreSQL 创建索引&quot;">​</a></h1><p>本文介绍在 PostgreSQL 中如何使用 <code>CREATE INDEX</code> 向一个表中添加索引。</p><p>在 PostgreSQL 中，您可以使用 <code>CREATE INDEX</code> 向一个表中添加索引。</p><h2 id="什么是索引" tabindex="-1">什么是索引 <a class="header-anchor" href="#什么是索引" aria-label="Permalink to &quot;什么是索引&quot;">​</a></h2><p>简单类比，索引可以看作是一个字典的目录。通过目录，您可以更快的查找词语。通过索引，您可以更快的从表中检索数据。索引是一种有序的数据结构，需要额外的空间存储。</p><h2 id="postgresql-create-index-语法" tabindex="-1">PostgreSQL <code>CREATE INDEX</code> 语法 <a class="header-anchor" href="#postgresql-create-index-语法" aria-label="Permalink to &quot;PostgreSQL \`CREATE INDEX\` 语法&quot;">​</a></h2><p>以下是 PostgreSQL <code>CREATE INDEX</code> 语句的简单语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> [ UNIQUE ] </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INDEX</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> [ [ IF NOT EXISTS ] </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ]</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> table_name [ USING method ]</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    column_name [ ASC | DESC ] [ NULLS { FIRST | LAST } ]</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    [, ...]</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>说明：</p><ul><li><code>name</code> 索引的名称。它是可选的。如果您不指定索引名称，PostgreSQL 将会自动生成一个。</li><li><code>table_name</code> 是要为其创建索引的表名。</li><li><code>method</code> 是索引方法的名称。包括 <code>btree</code>, <code>hash</code>, <code>gist</code>, <code>spgist</code>, <code>gin</code>, 和 <code>brin</code>。 <code>btree</code> 是默认的方法。您可以查看<a href="./索引类型.html">索引类型</a>以了解更多。</li><li><code>column_name</code> 是要创建索引的列名。</li><li><code>[ ASC | DESC ]</code> 指定排序是顺序还是逆序。 它是可选的， <code>ASC</code> 是默认值。</li><li><code>NULLS FIRST</code> 或 <code>NULLS LAST</code> 指定排序时空值在非空值之前或之后。当指定 <code>DESC</code> 时, <code>NULLS FIRST</code> 是默认的，否则 <code>NULLS LAST</code> 是默认的。</li><li><a href="/database/postgreSQL/databaseAndTable/唯一约束.html"><code>UNIQUE</code></a> 指示创建一个<a href="./唯一约束.html">唯一索引</a>。</li><li><code>IF NOT EXISTS</code> 指示只有指定的索引名称不存在时才创建索引。</li></ul><p>PostgreSQL 会对<a href="/database/postgreSQL/databaseAndTable/主键.html">主键</a>列自动创建索引。</p><p>要检查查询是否使用索引，请使用该 <a href="/database/postgreSQL/databaseAndTable/EXPLAIN.html"><code>EXPLAIN</code></a> 语句。</p><p>如果您在一个索引中使用了多个列，那么此索引被称为<a href="./多列索引.html">多列索引或复合索引</a>。</p><h2 id="postgresql-create-index-示例" tabindex="-1">PostgreSQL <code>CREATE INDEX</code> 示例 <a class="header-anchor" href="#postgresql-create-index-示例" aria-label="Permalink to &quot;PostgreSQL \`CREATE INDEX\` 示例&quot;">​</a></h2><p>我们将使用 <a href="/database/sakila/">PostgreSQL Sakila 示例数据库</a>中的 <a href="/database/sakila/地址表.html"><code>address</code></a> 表进行演示。</p><p>以下<a href="/database/postgreSQL/base/select.html">查询</a>查找邮编为 <code>x</code> 的地址：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> address</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> postal_code </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">x</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>由于该 <code>postal_code</code> 列没有可用的索引， PostgreSQL 不得不进行全表扫描。进可以通过查看查询计划来验证这一点。</p><p>要显示执行计划，请使用 <code>EXPLAIN</code> 如下语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">EXPLAIN</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> address</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> postal_code </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">x</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">                        QUERY</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> PLAN</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">----------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Seq</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> Scan</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> on</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> address</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  (cost=0.00..13.54 </span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">rows=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> width=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">161</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">   Filter:</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ((postal_code)::text = </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">x</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::text)</span></span></code></pre></div><p>要为 <code>address</code> 表 <code>postal_code</code> 列中的值创建索引，请使用以下语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> INDEX</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> address</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (postal_code);</span></span></code></pre></div><p>这里没有指定索引名称，PostgreSQL 将会自动生成一个索引名称： <code>address_postal_code_idx</code>。 格式为 表名加列名再加 <code>idx</code> 后缀。</p><p>现在，再次查看执行计划，您会发现数据库引擎使用索引进行查找：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">EXPLAIN</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> address</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> postal_code </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">x</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">                                       QUERY</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> PLAN</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">-----------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Index</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> Scan</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> using</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> address_postal_code_idx</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> on</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> address</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  (cost=0.28..8.29 </span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">rows=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> width=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">161</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">   Index</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> Cond:</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ((postal_code)::text = </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">x</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::text)</span></span></code></pre></div><p>这里， <code>using address_postal_code_idx</code> 说明了 PostgreSQL 使用了索引进行查找。</p><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>在 PostgreSQL 中，您可以使用 <code>CREATE INDEX</code> 向一个表中添加索引。</p>`,30)])])}const g=i(l,[["render",h]]);export{c as __pageData,g as default};
