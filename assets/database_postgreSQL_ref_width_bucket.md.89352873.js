import{_ as s,o as a,c as l,R as o}from"./chunks/framework.333b51ca.js";const D=JSON.parse('{"title":"PostgreSQL width_bucket() 函数","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/ref/width_bucket.md","filePath":"database/postgreSQL/ref/width_bucket.md","lastUpdated":1690011227000}'),n={name:"database/postgreSQL/ref/width_bucket.md"},p=o(`<h1 id="postgresql-width-bucket-函数" tabindex="-1">PostgreSQL width_bucket() 函数 <a class="header-anchor" href="#postgresql-width-bucket-函数" aria-label="Permalink to &quot;PostgreSQL width_bucket() 函数&quot;">​</a></h1><p>PostgreSQL <code>width_bucket()</code> 函数返回一个指定的操作数位于一些指定的桶中的位置。</p><h2 id="width-bucket-语法" tabindex="-1"><code>width_bucket()</code> 语法 <a class="header-anchor" href="#width-bucket-语法" aria-label="Permalink to &quot;\`width_bucket()\` 语法&quot;">​</a></h2><p>这里是 PostgreSQL <code>width_bucket()</code> 函数的语法：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket(operand, low, high, count) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">integer</span></span></code></pre></div><p>或者</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket(operand, thresholds) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">numeric</span></span></code></pre></div><h3 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-label="Permalink to &quot;参数&quot;">​</a></h3><ul><li><p><em><code>operand</code></em></p><p>必需的。 操作数。</p></li><li><p><em><code>low</code></em></p><p>必需的。 所有的桶的最小边界（包含）。</p></li><li><p><em><code>high</code></em></p><p>必需的。 所有的桶的最大边界（不包含）。</p></li><li><p><em><code>count</code></em></p><p>必需的。 桶的数量。</p></li><li><p><em><code>thresholds</code></em></p><p>必需的。 所有的桶都通过此数组定义。</p></li></ul><h3 id="返回值" tabindex="-1">返回值 <a class="header-anchor" href="#返回值" aria-label="Permalink to &quot;返回值&quot;">​</a></h3><p>PostgreSQL <code>width_bucket()</code> 函数返回操作数 <code>operand</code> 位于一些指定的桶中的位置。</p><p>根据上面的两种语法，您有两种方式指定桶：</p><ol><li>由边界 <code>low</code> 和 <code>high</code> 拆分的 <code>count</code> 个等宽桶。</li><li>由数组 <code>thresholds</code> 中的相邻的元素作为桶的边界定义桶。</li></ol><p>如果操作数 <code>operand</code> 不在边界之内，且操作数小于最小边界 <code>low</code>， <code>width_bucket()</code> 函数将返回 <code>0</code>。</p><p>如果操作数 <code>operand</code> 不在边界之内，且操作数小于等于最大边界 <code>high</code>， <code>width_bucket()</code> 函数将返回 <code>count + 1</code>。</p><h2 id="width-bucket-示例" tabindex="-1"><code>width_bucket()</code> 示例 <a class="header-anchor" href="#width-bucket-示例" aria-label="Permalink to &quot;\`width_bucket()\` 示例&quot;">​</a></h2><h3 id="基本用法" tabindex="-1">基本用法 <a class="header-anchor" href="#基本用法" aria-label="Permalink to &quot;基本用法&quot;">​</a></h3><p>下面的示例演示了 <code>width_bucket()</code> 函数的基本用法。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> width_bucket(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--------------</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">3</span></span></code></pre></div><p>这里，我们看到了 <code>width_bucket(6, 2, 8, 3)</code> 返回了 <code>3</code>。它的计算步骤如下：</p><ol><li><p>首先将范围 <code>[2, 8)</code> 分成 3 个等宽的桶：</p><ul><li><code>[2, 4)</code> - 第 1 个桶</li><li><code>[4, 6)</code> - 第 2 个桶</li><li><code>[6, 8)</code> - 第 3 个桶</li></ul><p>注意，这里的低边界 <code>2</code> 是包含在桶之内的，而高边界 <code>8</code> 是不包含在桶之内的。</p></li><li><p>比较 <code>6</code> 落在哪个桶中。很显然， <code>6</code> 是落在第 3 个桶 <code>[6, 8)</code> 中的。</p></li><li><p>因此，<code>width_bucket(6, 2, 8, 3)</code> 返回了 <code>3</code>。</p></li></ol><p>我们可以更换一些其他的值已验证上面的计算是否正确。比如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(3, 2, 8, 3)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(5, 2, 8, 3)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) | width_bucket(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--------------------------+--------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> |                        </span><span style="color:#F78C6C;">2</span></span></code></pre></div><p>这里，操作数 <code>3</code> 是落在第 1 个桶 <code>[2, 4)</code> 中的，操作数 <code>5</code> 是落在第 2 个桶 <code>[4, 6)</code> 中的。</p><p>我们还可以提供一个小于低边界的值，比如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> width_bucket(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(1, 2, 8, 3)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#F78C6C;">0</span></span></code></pre></div><p>这里，由于操作数 <code>1</code> 比低边界 <code>2</code> 还要小，它不属于任何一个桶，因此 <code>width_bucket(1, 2, 8, 3)</code> 返回了 <code>0</code>。</p><p>我们还可以提供一个大于高边界的值，比如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(8, 2, 8, 3)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(9, 2, 8, 3)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) | width_bucket(</span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--------------------------+--------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> |                        </span><span style="color:#F78C6C;">4</span></span></code></pre></div><p>这里，因为操作数不属于任何一个桶，并且大于等于高边界 <code>8</code>，因此它返回了 <code>4</code>（桶的数量加 1）。</p><h3 id="数组桶" tabindex="-1">数组桶 <a class="header-anchor" href="#数组桶" aria-label="Permalink to &quot;数组桶&quot;">​</a></h3><p>我们也可以使用数组定义桶。</p><p>比如： <code>array[2, 4, 6, 8]::int[]</code> 同样定义了和上面例子中相同的桶：</p><ul><li><code>[2, 4)</code> - 第 1 个桶</li><li><code>[4, 6)</code> - 第 2 个桶</li><li><code>[6, 8)</code> - 第 3 个桶</li></ul><p>我们通过数组改写一下上面的示例</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(6, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(3, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(5, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(1, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(8, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    width_bucket(</span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width_bucket(9, array[2, 4, 6, 8]::int[])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">[ RECORD 1 ]</span><span style="color:#676E95;font-style:italic;">-----------------------------+--</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">width_bucket(</span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">array</span><span style="color:#A6ACCD;">[2, 4, 6, 8]::</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">[]) | </span><span style="color:#F78C6C;">4</span></span></code></pre></div>`,41),e=[p];function t(c,C,r,y,A,i){return a(),l("div",null,e)}const h=s(n,[["render",t]]);export{D as __pageData,h as default};
