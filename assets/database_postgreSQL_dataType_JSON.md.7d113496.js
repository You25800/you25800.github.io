import{_ as s,o as a,c as o,R as n}from"./chunks/framework.333b51ca.js";const i=JSON.parse('{"title":"PostgreSQL JSON 数据类型介绍","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/dataType/JSON.md","filePath":"database/postgreSQL/dataType/JSON.md","lastUpdated":1690289709000}'),l={name:"database/postgreSQL/dataType/JSON.md"},p=n(`<h1 id="postgresql-json-数据类型介绍" tabindex="-1">PostgreSQL JSON 数据类型介绍 <a class="header-anchor" href="#postgresql-json-数据类型介绍" aria-label="Permalink to &quot;PostgreSQL JSON 数据类型介绍&quot;">​</a></h1><p>本文介绍了在 PostgreSQL 中如何使用 JSON 类型以及一些用于处理 JSON 数据的有用的函数。</p><p>JSON 是一种通用的、轻量级的数据传输格式，它可以表示复杂的、结构化的数据，但同时也易于阅读和编写。</p><p>PostgreSQL 从 9.2 版本开始支持原生 JSON 数据类型，并且提供了许多用于操作 JSON 数据的函数和运算符。</p><h2 id="json-简介" tabindex="-1">JSON 简介 <a class="header-anchor" href="#json-简介" aria-label="Permalink to &quot;JSON 简介&quot;">​</a></h2><p>JSON 定义了以下几种类型的值：</p><ul><li>对象</li><li>数组</li><li>字符串</li><li>数字</li><li><code>true</code></li><li><code>false</code></li><li><code>null</code></li></ul><p>JSON 对象是一个键值对的组合。键是字符串类型的文本，值可以是上面定义的几种类型的任何一种。</p><p>JSON 数组是一些值的组合。其中的值可以是任意的以上一种类型的值。</p><p>一个 JSON 值可以是以上任意类型的值。</p><p>比如，以下是一些纯值的 JSON 值：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello World</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F78C6C;">1.23</span></span>
<span class="line"><span style="color:#F78C6C;">123.456</span></span>
<span class="line"><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#89DDFF;">null</span></span></code></pre></div><p>以下是一个 JSON 对象的示例：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">x</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hollo World</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">y</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">o</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>以下是一个 JSON 数组的示例：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null]</span></span></code></pre></div><p>通常情况下，我们在传输数据的时使用 JSON 对象和 JSON 数组。</p><h2 id="postgresql-json-介绍" tabindex="-1">PostgreSQL JSON 介绍 <a class="header-anchor" href="#postgresql-json-介绍" aria-label="Permalink to &quot;PostgreSQL JSON 介绍&quot;">​</a></h2><p>PostgreSQL 支持两种 JSON 类型： <code>JSON</code> 和 <code>JSONB</code>。他们的处理效率不同。 <code>JSON</code> 按文本保存输入数据，保留原始数据中的空格，重复键。 <code>JSONB</code> 则按照二进制保存输入数据，他会删除没必要的空格以及重复的键。</p><h3 id="json-文本转为-json-类型" tabindex="-1">JSON 文本转为 JSON 类型 <a class="header-anchor" href="#json-文本转为-json-类型" aria-label="Permalink to &quot;JSON 文本转为 JSON 类型&quot;">​</a></h3><p>要将一个字符串的 JSON 文本转为 JSON 类型的值，您可以使用如下两种方法：</p><ul><li>使用 <code>JSON()</code> 构造函数将 JSON 文本转为 JSON 类型的值：</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[1, 2, 3]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><ul><li>使用类型转换将 JSON 文本转为 JSON 类型的值：</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;a&quot;: [1, 2, 3]}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">::</span><span style="color:#F78C6C;">json</span></span></code></pre></div><h3 id="json-操作符" tabindex="-1">JSON 操作符 <a class="header-anchor" href="#json-操作符" aria-label="Permalink to &quot;JSON 操作符&quot;">​</a></h3><p>PostgreSQL 提供了几个用于 JSON 数据的操作符，如下：</p><ul><li><code>-&gt;</code>: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为 JSON 类型的值。</li><li><code>-&gt;&gt;</code>: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为文本。</li><li><code>#&gt;</code>: 获取指定路径的值，返回值为 JSON 类型的值。</li><li><code>#&gt;&gt;</code>: 获取指定路径的值，返回值为文本。</li></ul><h2 id="postgresql-json-实例" tabindex="-1">PostgreSQL JSON 实例 <a class="header-anchor" href="#postgresql-json-实例" aria-label="Permalink to &quot;PostgreSQL JSON 实例&quot;">​</a></h2><p>使用下面的语句<a href="/database/postgreSQL/databaseAndTable/创建表.html">创建一个新表</a>，名称为 <code>login_logs</code>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login_logs</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">  id </span><span style="color:#C792EA;">INT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">GENERATED</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ALWAYS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">IDENTITY</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#F78C6C;">JSON</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT NULL</span></span>
<span class="line"><span style="color:#A6ACCD;">);</span></span></code></pre></div><p>该 <code>login_logs</code> 表由两列组成：</p><ol><li>该 <code>id</code> 列是标识每行的<a href="/database/postgreSQL/databaseAndTable/主键.html">主键列</a>，它是一个<a href="/database/postgreSQL/databaseAndTable/标识列.html">标识列</a>。</li><li>该 <code>detail</code> 是 JSON 数据类型。</li></ol><h3 id="插入-json-数据" tabindex="-1">插入 JSON 数据 <a class="header-anchor" href="#插入-json-数据" aria-label="Permalink to &quot;插入 JSON 数据&quot;">​</a></h3><p>要将数据插入 JSON 列，您必须确保数据采用有效的 JSON 格式。以下 <a href="/database/postgreSQL/base/INSERT.html"><code>INSERT</code></a> 语句向 <code>login_logs</code> 表中插入几个新行。</p><div class="language-postgres"><button title="Copy Code" class="copy"></button><span class="lang">postgres</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">INSERT INTO login_logs (detail)</span></span>
<span class="line"><span style="color:#A6ACCD;">VALUES</span></span>
<span class="line"><span style="color:#A6ACCD;">  (&#39;{ &quot;name&quot;: &quot;Tom&quot;, &quot;address&quot;: {&quot;ip&quot;: &quot;192.168.1.23&quot;,&quot;country&quot;: &quot;US&quot;}}&#39;),</span></span>
<span class="line"><span style="color:#A6ACCD;">  (&#39;{ &quot;name&quot;: &quot;Tim&quot;, &quot;address&quot;: {&quot;ip&quot;: &quot;192.168.1.24&quot;,&quot;country&quot;: &quot;US&quot;}}&#39;),</span></span>
<span class="line"><span style="color:#A6ACCD;">  (&#39;{ &quot;name&quot;: &quot;Jim&quot;, &quot;address&quot;: {&quot;ip&quot;: &quot;192.168.1.25&quot;,&quot;country&quot;: &quot;UK&quot;}}&#39;);</span></span></code></pre></div><p>这里， <code>detail</code> 列中的 JSON 值是 JSON 对象，其中包含两个键：</p><ul><li><p><code>name</code> 是登陆用户的名称。</p></li><li><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">address</span></span></code></pre></div><p>是登陆用户的地址，它也是一个 JSON 对象，包含了两个成员：</p><ul><li><code>ip</code> 是登陆用户的 IP 地址。</li><li><code>country</code> 是登陆用户所在的国家。</li></ul></li></ul><h3 id="查询-json-数据" tabindex="-1">查询 JSON 数据 <a class="header-anchor" href="#查询-json-数据" aria-label="Permalink to &quot;查询 JSON 数据&quot;">​</a></h3><p>要查询 JSON 数据，请使用该 <a href="/database/postgreSQL/base/select.html"><code>SELECT</code></a> 语句：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> login_logs;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                               </span><span style="color:#FFCB6B;">detail</span></span>
<span class="line"><span style="color:#FFCB6B;">----+---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;name&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.1.23</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">US</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">}}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;name&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tim</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.1.24</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">US</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">}}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;name&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Jim</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.1.25</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UK</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">}}</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rows</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>如果您想显示 JSON 对象内部的字段，请使用 <code>-&gt;</code> 和 <code>-&gt;&gt;</code> 操作符。 <code>-&gt;</code> 返回的值是 JSON 类型， <code>-&gt;&gt;</code> 返回的值是文本类型。</p><p>以下查询分别使用两个运算符 <code>-&gt;</code> 和 <code>-&gt;&gt;</code> 以 JSON 的形式获取所有登陆用户的名称：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> name_json,</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> name_text</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#A6ACCD;">  login_logs;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">name_json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">name_text</span></span>
<span class="line"><span style="color:#FFCB6B;">-----------+-----------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;Tom&quot;</span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tom</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;Tim&quot;</span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tim</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;Jim&quot;</span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Jim</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rows</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>要获取所有登陆用的国家和 IP，请使用下面的语句：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> country,</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ip</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> ip</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> login_logs;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">country</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">ip</span></span>
<span class="line"><span style="color:#FFCB6B;">---------+--------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">US</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">192.168.1.23</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">US</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">192.168.1.24</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UK</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">192.168.1.25</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rows</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>首先 <code>detail -&gt; &#39;address&#39;</code> 将地址作为 JSON 对象返回。然后 <code>detail -&gt; &#39;address&#39; -&gt;&gt; &#39;country&#39;</code> 将所有国家作为文本返回。</p><h3 id="在-where-条件中使用-json-运算符" tabindex="-1">在 WHERE 条件中使用 JSON 运算符 <a class="header-anchor" href="#在-where-条件中使用-json-运算符" aria-label="Permalink to &quot;在 WHERE 条件中使用 JSON 运算符&quot;">​</a></h3><p>您可以在 <a href="/database/postgreSQL/base/WHERE.html"><code>WHERE</code></a> 子句中使用 JSON 运算符来过滤返回的行。</p><p>例如，要找出所有来自 US 的登陆用户，清使用以下查询：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> country</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#A6ACCD;">  login_logs</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span></span>
<span class="line"><span style="color:#A6ACCD;">  detail </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">address</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">country</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">US</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">country</span></span>
<span class="line"><span style="color:#FFCB6B;">------+---------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tom</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">US</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tim</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">US</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rows</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="postgresql-json-函数" tabindex="-1">PostgreSQL JSON 函数 <a class="header-anchor" href="#postgresql-json-函数" aria-label="Permalink to &quot;PostgreSQL JSON 函数&quot;">​</a></h2><p>PostgreSQL 提供了很多 JSON 相关的函数，如下：</p><ul><li><a href="/database/postgreSQL_ref/array_to_json.html"><code>array_to_json()</code></a>: 将一个 SQL 数组转为 JSON 数组并返回。</li><li><a href="/database/postgreSQL_ref/json_array_elements.html"><code>json_array_elements()</code></a>: 将顶层 JSON 数组扩展为一个 JSON 值的集合。</li><li><a href="/database/postgreSQL_ref/json_array_length.html"><code>json_array_length()</code></a>: 返回一个指定的 JSON 数组的长度。</li><li><a href="/database/postgreSQL_ref/json_build_array.html"><code>json_build_array()</code></a>: 从可变的参数列表中创建一个可能是异构类型的 JSON 数组。</li><li><a href="/database/postgreSQL_ref/json_each.html"><code>json_each()</code></a>: 将一个指定的 JSON 对象扩展为一个键值对的集合。</li><li><a href="/database/postgreSQL_ref/json_extract_path.html"><code>json_extract_path()</code></a>: 从一个指定的 JSON 值中提取指定的路径的值。</li><li><a href="/database/postgreSQL_ref/json_object_keys.html"><code>json_object_keys()</code></a>: 返回指定的 JSON 对象中的顶层键的集合。</li><li><a href="/database/postgreSQL_ref/json_object.html"><code>json_object()</code></a>: 从一个文本数组构建一个 JSON 对象，或者从两个分别作为键和值的数组构建一个 JSON 对象。</li><li><a href="/database/postgreSQL_ref/json_to_record.html"><code>json_to_record()</code></a>: 将指定的最顶层的 JSON 对象扩展为一个在 AS 子句中定义的具有符合类型的行。</li><li><a href="/database/postgreSQL_ref/json_to_recordset.html"><code>json_to_recordset()</code></a>: 将指定的最顶层的 JSON 数组（元素为对象）扩展为一个在 AS 子句中定义的具有符合类型的行的集合。</li><li><a href="/database/postgreSQL_ref/json_typeof.html"><code>json_typeof()</code></a>: 以字符串的形式返回指定的 JSON 值的类型。</li><li><a href="/database/postgreSQL_ref/row_to_json.html"><code>row_to_json()</code></a>: 将一个 SQL 复合类型的值转为 JSON 对象并返回。</li><li><a href="/database/postgreSQL_ref/to_json.html"><code>to_json()</code></a>: 将一个 SQL 值转为 JSON 值并返回。</li></ul><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>本文讨论了 PostgreSQL JSON 数据类型，以及一些常用的 JSON 操作符和函数。</p>`,60),e=[p];function t(c,r,D,y,C,F){return a(),o("div",null,e)}const d=s(l,[["render",t]]);export{i as __pageData,d as default};
