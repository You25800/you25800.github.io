import{_ as i,c as a,o as h,b3 as t}from"./chunks/framework.CatkIGlB.js";const g=JSON.parse('{"title":"使用 PostgreSQL CHECK 约束来保证数据的正确性","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/databaseAndTable/CHECK约束.md","filePath":"database/postgreSQL/databaseAndTable/CHECK约束.md","lastUpdated":1689061386000}'),n={name:"database/postgreSQL/databaseAndTable/CHECK约束.md"};function l(k,s,e,p,d,A){return h(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="使用-postgresql-check-约束来保证数据的正确性" tabindex="-1">使用 PostgreSQL CHECK 约束来保证数据的正确性 <a class="header-anchor" href="#使用-postgresql-check-约束来保证数据的正确性" aria-label="Permalink to &quot;使用 PostgreSQL CHECK 约束来保证数据的正确性&quot;">​</a></h1><p>在本文中，您将了解如何使用 PostgreSQL CHECK 约束来保证写入到表中的数据是正确的。</p><p>任何应用都对数据的正确性有要求。比如，用户的年龄必须是大于零的，用户的登录名中不能包含空格，用户的密码必须满足一定的复杂度，等等。</p><p>对于这些要求，虽然我们可以在应用界面来对用户输入的数据进行验证，但是这并不能替代数据库层面的数据验证。这能增加应用的安全性。</p><p>PostgreSQL 提供了 <code>CHECK</code> 约束来保证写入到表中的数据是符合你的要求的。不符合 <code>CHECK</code> 约束的数据会被 PostgreSQL 拒绝。</p><h2 id="postgresql-check-语法" tabindex="-1">PostgreSQL <code>CHECK</code> 语法 <a class="header-anchor" href="#postgresql-check-语法" aria-label="Permalink to &quot;PostgreSQL \`CHECK\` 语法&quot;">​</a></h2><p>下面是 PostgreSQL <code>CHECK</code> 的语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">[CONSTRAINT constraint_name]</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(expr)</span></span></code></pre></div><p>解释说明：</p><ul><li><code>constraint_name</code> 是约束的名字。 <code>CONSTRAINT constraint_name</code> 是可选的，只有您需要指定约束名称的时候，才使用此子句。</li><li><code>expr</code> 是一个布尔表达式。如果表达式结算结果为真，则 PostgreSQL 允许将输入写入到表中，否则 PostgreSQL 拒绝写入数据。</li></ul><p>您可以在一个列上或者一个表上使用 <code>CHECK</code> 约束。如果你为一个列使用 <code>CHECK</code> 约束，则 <code>CHECK</code> 表达式只能使用此列。如果你为一个表使用 <code>CHECK</code> 约束，则 <code>CHECK</code> 表达式可以使用表上的所有列。</p><p>下面以 <code>age</code> 列需要大于 0 为例，使用不同的方法添加此约束：</p><ul><li><p>在创建表的时候在列定义中使用 <code>CHECK</code> 约束</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> users</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    age </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(age </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 0</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div></li><li><p>在创建表的时候在约束定义中使用 <code>CHECK</code> 约束</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> users</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    age </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users_age_check </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(age </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 0</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div></li><li><p>使用修改表语句的添加 <code>CHECK</code> 约束</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users_age_check </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(age </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 0</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div></li></ul><h2 id="postgresql-check-约束实例" tabindex="-1">PostgreSQL <code>CHECK</code> 约束实例 <a class="header-anchor" href="#postgresql-check-约束实例" aria-label="Permalink to &quot;PostgreSQL \`CHECK\` 约束实例&quot;">​</a></h2><p>通过下面的例子，你会很容易理解 PostgreSQL <code>CHECK</code> 约束的用法和作用。</p><p>假设，您需要一个 <code>users</code> 表存储用户的名称，登录名，密码，且需要符合以下要求：</p><ol><li>用户的名称不能为空。</li><li>登录名的长度不少于 4 个字符。</li><li>密码的长度不少于 8 个字符。</li><li>密码不能和登录名相同。</li></ol><p>注意，在实际的应用中，您不应该将密码的明文存放在数据库中，这是不安全的。</p><p>使用以下的 <code>CREATE TABLE</code> 语句<a href="./创建表.html">创建表</a>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> users</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">SERIAL</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    name</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    login_name </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">length</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(login_name) </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 4</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">),</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    password</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">length</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 8</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(login_name </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&lt;&gt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>这里，在 <code>CREATE TABLE</code> 语句中有 3 个 <code>CHECK</code> 约束：</p><ol><li>在 <code>login_name</code> 列定义中的 <code>CHECK(length(login_name) &gt;= 4)</code> 保证登录名的长度不小于 4。</li><li>在 <code>password</code> 列定义中的 <code>CHECK(length(password) &gt;= 8)</code> 保证登录名的长度不小于 8。</li><li>在表上的约束 <code>CHECK(login_name &lt;&gt; password)</code> 保证密码不能和登录名相同。</li></ol><p>通过以下 <code>\\d</code> 命令查看表 <code>users</code> 上的约束：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">\\d users</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">                                     Table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">public.users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   Column   |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Type</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">          | Collation | Nullable |              </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">Default</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">------------+-----------------------+-----------+----------+-----------------------------------</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> id         | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">integer</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">               |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | nextval(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_id_seq</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::regclass)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">       | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">character varying</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> login_name | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">character varying</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">character varying</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Indexes:</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_pkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, btree (id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">Check</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> constraints:</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (login_name::</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">text</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &lt;&gt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">text</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_login_name_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">length</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(login_name::</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">text</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 4</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_password_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CHECK</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">length</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">text</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 8</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>您能够在上面的输出中发现， <code>users</code> 表中有 3 个 <code>CHECK</code> 约束。约束的名称都是 PostgreSQL 按默认规则生成的。</p><p>注意， <a href="./NOT_NULL.html"><code>NOT NULL</code> 也是一种约束</a>。</p><p>要验证登录名列的 <code>CHECK</code> 约束是否生效，请<a href="/database/postgreSQL/base/INSERT.html">使用下面的 <code>INSERT</code> 语句尝试插入一行</a>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, login_name, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">timisok</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  new </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> for</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> relation </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">check</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_login_name_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  Failing </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> contains (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, Tim, tim, timisok).</span></span></code></pre></div><p>由于上面语句中给出的登录名 <code>tim</code> 的长度小于 4，因此 PostgreSQL 给出了上面的错误。</p><p>要验证密码列的 <code>CHECK</code> 约束是否生效，请使用下面的 <code>INSERT</code> 语句尝试插入一行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, login_name, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">tim1</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">timisok</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  new </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> for</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> relation </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">check</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_password_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  Failing </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> contains (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, Tim, tim1, timisok).</span></span></code></pre></div><p>由于上面语句中给出的密码 <code>timisok</code> 的长度小于 8，因此 PostgreSQL 给出了上面的错误。</p><p>要验证密码不能和登录名相同的 <code>CHECK</code> 约束是否生效，请使用下面的 <code>INSERT</code> 语句尝试插入一行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, login_name, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">timisgood</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">timisgood</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  new </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> for</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> relation </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">check</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  Failing </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> contains (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">3</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, Tim, timisgood, timisgood).</span></span></code></pre></div><p>由于上面语句中给出的登录名和密码都是 <code>timisgood</code>，因此 PostgreSQL 给出了上面的错误。</p><p>使用下面的语句插入一个完全符合 <code>CHECK</code> 约束的行。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, login_name, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">password</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">hitim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">timisgood</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>这一行成功插入到了 <code>users</code> 表中。</p><p><code>CHECK</code> 约束同样适用于 <code>UPDATE</code> 语句，比如：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SET</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> login_name </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> name</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> =</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  new </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> for</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> relation </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">check</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users_login_name_check</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  Failing </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">row</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> contains (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">4</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, Tim, tim, timisgood).</span></span></code></pre></div><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>PostgreSQL 提供了 <code>CHECK</code> 约束来保证存储到表中的数据是符合你的要求的。不符合 <code>CHECK</code> 约束的数据会被拒绝写入到表中。</p><p>您可以在列上或者表上使用 <code>CHECK</code> 约束。</p>`,48)])])}const D=i(n,[["render",l]]);export{g as __pageData,D as default};
