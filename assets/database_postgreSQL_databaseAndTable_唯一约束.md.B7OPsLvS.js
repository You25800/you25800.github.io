import{_ as i,c as a,o as h,b3 as n}from"./chunks/framework.CatkIGlB.js";const g=JSON.parse('{"title":"PostgreSQL UNIQUE 唯一约束","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/databaseAndTable/唯一约束.md","filePath":"database/postgreSQL/databaseAndTable/唯一约束.md","lastUpdated":1690289709000}'),l={name:"database/postgreSQL/databaseAndTable/唯一约束.md"};function e(t,s,p,k,d,r){return h(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="postgresql-unique-唯一约束" tabindex="-1">PostgreSQL UNIQUE 唯一约束 <a class="header-anchor" href="#postgresql-unique-唯一约束" aria-label="Permalink to &quot;PostgreSQL UNIQUE 唯一约束&quot;">​</a></h1><p>在本文中，我们介绍 PostgreSQL 中如何使用唯一约束/唯一索引保证一列或几列的值是唯一的。</p><p>在 PostgreSQL 中，我们可以在一个表上定义很多约束，比如<a href="./主键.html">主键约束</a>、<a href="./外键.html">外键约束</a>。唯一约束也是一个常用的约束，用来保证表中的一列或几列的中的值是唯一的。</p><p>我们在很多系统中都用到唯一约束约束，例如：</p><ul><li>用户表中有登录名或电子邮件列是唯一的。</li><li>产品表中的产品编号列是唯一的。</li><li>订单表中有订单编号列是唯一的。</li><li>每天的统计报表中将 年、月、日 三个列作为组合唯一约束。</li></ul><p>与主键相比，主键用于表示一个行的唯一性，主键的一般采用一个与业务无关的值，比如自增值，UUID 等。而唯一约束一般用于约束与业务相关的数据的唯一性。</p><p>主键列不能包含 <code>NULL</code> 值，而唯一约束列可以包含 <code>NULL</code> 值。</p><p>在 PostgreSQL 中，一个唯一约束对应了一个唯一索引。</p><h2 id="unique-语法" tabindex="-1">UNIQUE 语法 <a class="header-anchor" href="#unique-语法" aria-label="Permalink to &quot;UNIQUE 语法&quot;">​</a></h2><p>要定义唯一约束，请使用 <code>UNIQUE</code> 关键字。您可以在<a href="./创建表.html">创建表</a>的时候定义唯一约束或者创建表后通过<a href="./修改表.html">修改表</a>增加一个唯一约束。</p><h3 id="定义一列为唯一约束" tabindex="-1">定义一列为唯一约束 <a class="header-anchor" href="#定义一列为唯一约束" aria-label="Permalink to &quot;定义一列为唯一约束&quot;">​</a></h3><p>这里是创建表时定义一列为唯一列的语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> table_name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    ...,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    column_name data_type </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UNIQUE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    ...</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><h3 id="定义多列为唯一约束" tabindex="-1">定义多列为唯一约束 <a class="header-anchor" href="#定义多列为唯一约束" aria-label="Permalink to &quot;定义多列为唯一约束&quot;">​</a></h3><p>如果唯一约束包含多个列，请使用如下语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> table_name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   column_name1 column_definition,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   column_name2 column_definition,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   ...,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   [CONSTRAINT constraint_name]</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">      UNIQUE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(column_name1, column_name2)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>这里：</p><ul><li><code>CONSTRAINT constraint_name</code> 用于定义一个约束的名称。 它是可选的。如果不定义约束名称， PostgreSQL 会自动为他生成一个。</li><li><code>UNIQUE</code> 关键子后的括号中包含了逗号分隔的多个列。</li></ul><h3 id="添加唯一约束语法" tabindex="-1">添加唯一约束语法 <a class="header-anchor" href="#添加唯一约束语法" aria-label="Permalink to &quot;添加唯一约束语法&quot;">​</a></h3><p>我们也可以向已有的表中添加一个唯一约束。这是添加唯一约束的语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> [CONSTRAINT constraint_name] </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UNIQUE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (column_list);</span></span></code></pre></div><p>注意，如果现有表中的要设置为唯一约束的列中已有重复数据， PostgreSQL 服务器会返回错误。</p><h3 id="删除唯一约束语法" tabindex="-1">删除唯一约束语法 <a class="header-anchor" href="#删除唯一约束语法" aria-label="Permalink to &quot;删除唯一约束语法&quot;">​</a></h3><p>要从表上删除唯一约束，你可以使用 <code>ALTER TABLE</code> 语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">  DROP</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> constraint_name;</span></span></code></pre></div><h2 id="postgresql-unique-实例" tabindex="-1">PostgreSQL <code>UNIQUE</code> 实例 <a class="header-anchor" href="#postgresql-unique-实例" aria-label="Permalink to &quot;PostgreSQL \`UNIQUE\` 实例&quot;">​</a></h2><p>让我们看一些实际的例子来了解唯一约束约束的用法。</p><p>首先，我们首先创建一个演示表 <code>user_hobby</code>，它有一个包含了 2 列的唯一约束。也就是说，同一个用户不能有两个相同的业余爱好。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> IF</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> user_hobby</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">SERIAL</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> unique_user_hobby</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    UNIQUE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>这里，我们定义了一个名字为 <code>unique_user_hobby</code> 唯一约束，它包含了 <code>user_id</code> 和 <code>hobby</code> 2 列。</p><p>然后，我们插入两行测试数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby (user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Swimming</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>现在我们查看一下表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id |  hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Football</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Swimming</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><h3 id="唯一约束" tabindex="-1">唯一约束 <a class="header-anchor" href="#唯一约束" aria-label="Permalink to &quot;唯一约束&quot;">​</a></h3><p>让我们再插入一行和已有 <code>user_id</code> 和 <code>hobby</code> 列相同的数据</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby (user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  duplicate </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">key</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> value</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">unique</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">unique_user_hobby</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id, hobby)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, Football) already </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">exists</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">.</span></span></code></pre></div><p>PostgreSQL 返回了上述错误。唯一约束约束避免了插入重复的数据。</p><h3 id="删除唯一约束" tabindex="-1">删除唯一约束 <a class="header-anchor" href="#删除唯一约束" aria-label="Permalink to &quot;删除唯一约束&quot;">​</a></h3><p>让我们通过下面的语句删除唯一约束：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">  DROP</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> unique_user_hobby;</span></span></code></pre></div><p>你需要提供约束名称以供删除。如果你不知道它的名字或者创建唯一约束的时候未指定约束名，请使用 <code>\\d</code> 命令显示一个表中的所有的索引名：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">\\d user_hobby</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">                                       Table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">public.user_hobby</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">  Column</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">  |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">         Type</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">          |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Collation</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Nullable</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">                   Default</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">----------+-----------------------+-----------+----------+----------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> hobby_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> integer</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">               |</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">           |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> not</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> nextval(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">&#39;user_hobby_hobby_id_seq&#39;</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;">:</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">:regclass</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> user_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">  |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> integer</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">               |</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">           |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> not</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> hobby</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> character</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> varying</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">45</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">           |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> not</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">Indexes:</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">    &quot;user_hobby_pkey&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> PRIMARY</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> KEY,</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> btree</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">    &quot;unique_user_hobby&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> UNIQUE</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> CONSTRAINT,</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> btree</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id, </span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">hobby</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><h2 id="唯一约束与-null-值" tabindex="-1">唯一约束与 NULL 值 <a class="header-anchor" href="#唯一约束与-null-值" aria-label="Permalink to &quot;唯一约束与 NULL 值&quot;">​</a></h2><p>不像主键，唯一约束允许其中的列接受 <code>NULL</code> 值。但是，<code>NULL</code> 值会破坏唯一约束约束。也就是唯一约束对 <code>NULL</code> 值无效。让我们看一下下面的例子。</p><p>现在我们修改一下刚刚的建表语句，其中允许 <code>hobby</code> 列为 <code>NULL</code>:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> IF</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> user_hobby</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">SERIAL</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> unique_user_hobby</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    UNIQUE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>让我们插入两行一样的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby (user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>然后让我们看一下表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobby;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id | hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+--------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&lt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&lt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>我们看到了唯一约束的两列出现了重复的 NULL 值。<code>NULL</code> 让唯一约束失效了。</p><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>在本文中，我们学习了在 PostgreSQL 中唯一约束的用法。以下是本文的要点内容：</p><ul><li>唯一约束用来保证表中的一列或几列的中的值的唯一性。</li><li>请使用 <code>UNIQUE</code> 关键字定义唯一约束。</li><li>唯一约束列允许 <code>NULL</code> 值，而主键不可以为 <code>NULL</code>。</li></ul>`,59)])])}const o=i(l,[["render",e]]);export{g as __pageData,o as default};
