import{_ as i,c as a,o as h,b3 as n}from"./chunks/framework.CatkIGlB.js";const l="/assets/foreign-key-er.DmJfaqyx.svg",D=JSON.parse('{"title":"PostgreSQL FOREIGN KEY 外键","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/databaseAndTable/外键.md","filePath":"database/postgreSQL/databaseAndTable/外键.md","lastUpdated":1690289709000}'),k={name:"database/postgreSQL/databaseAndTable/外键.md"};function t(p,s,e,d,r,A){return h(),a("div",null,[...s[0]||(s[0]=[n('<h1 id="postgresql-foreign-key-外键" tabindex="-1">PostgreSQL FOREIGN KEY 外键 <a class="header-anchor" href="#postgresql-foreign-key-外键" aria-label="Permalink to &quot;PostgreSQL FOREIGN KEY 外键&quot;">​</a></h1><p>在本文中，我们介绍了什么是外键、外键的规则以及如何在 PostgreSQL 中使用外键。</p><p>在关系数据库中，外键用来定义两个实体之间的约束关系。外键对保证数据的完整性很有用。</p><h2 id="什么是外键" tabindex="-1">什么是外键 <a class="header-anchor" href="#什么是外键" aria-label="Permalink to &quot;什么是外键&quot;">​</a></h2><p>外键相对于主键而言，用来引用其他表。外键在子表中定义，它将子表的一个或多个列对应到父表的主键或唯一键值，将子表的行和父表行建立起关联关系。</p><p>让我们看一下 Sakila 示例数据库中的<a href="/database/sakila/国家表.html"><code>country</code></a> 表和 <a href="/database/sakila/城市表.html"><code>city</code></a> 表。下面是它们的关系图：</p><p><img src="'+l+`" alt="country 和 city 关系">country 和 city 关系</p><p>以下是 <code>country</code> 表中的部分数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country_id | country |     last_update</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">------------+---------+---------------------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">         23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | China   | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">44</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">00</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> row</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>以下是 <code>city</code> 表中的部分数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> *</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city_id |     city      | country_id |     last_update</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">---------+---------------+------------+---------------------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">      46</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Baicheng      |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">25</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">      47</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Baiyin        |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">25</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">      80</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Binzhou       |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">25</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">     109</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Changzhou     |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">25</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">     136</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Datong        |         </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">23</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2006</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">02</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">15</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 04</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">25</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">...</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">53</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>由此我们看出，<code>country</code> 表和 <code>city</code> 表是一对多的关系。一个国家中可以有多个城市，一个城市只能位于一个国家。</p><p>如果一个国家已经有了城市，那么你就不能轻易的从 <code>country</code> 表删除国家，否则就会造成对应的城市数据的不完整。你也不能为一个城市设定一个不存在的 <code>country_id</code>，否则这个城市数据就是错误的。</p><p>外键约束能保证数据的完整和正确。</p><p>通常，外键所属的表被称作子表，被外键引用的表被称作父表。</p><h2 id="外键的语法" tabindex="-1">外键的语法 <a class="header-anchor" href="#外键的语法" aria-label="Permalink to &quot;外键的语法&quot;">​</a></h2><h3 id="创建表时添加外键" tabindex="-1">创建表时添加外键 <a class="header-anchor" href="#创建表时添加外键" aria-label="Permalink to &quot;创建表时添加外键&quot;">​</a></h3><p>要在创建表时添加外键，请使用以下语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> table_name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  column_defination_1,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  ...</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  [CONSTRAINT foreign_key_name]</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (column)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">      REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> parent_table_name (column)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">      ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ...</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">      ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ...</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>解释说明：</p><ul><li><code>foreign_key_name</code> 是外键约束的名字。 <code>CONSTRAINT foreign_key_name</code> 是可选的。</li><li><code>FOREIGN KEY (column)</code> 指明了表中的 <code>column</code> 列是外键。</li><li><code>REFERENCES parent_table_name (column)</code> 指明了外键引用了 <code>parent_table_name</code> 表中的 <code>column</code> 列。</li><li><code>ON DELETE</code> 和 <code>ON UPDATE</code> 指定了删除或更新父表中的行时要采取的约束策略。你可以使用以下 5 个策略中的一个： <ul><li><code>NO ACTION</code>: 这是默认的策略。</li><li><code>RESTRICT</code>: 如果父表中的一行在该表中有匹配的行，试图删除或更新父表中行时会引发 PostgreSQL 错误。</li><li><code>CASCADE</code>：如果父表中的一行被删除或更新，该表中匹配行的值会自动删除或更新。</li><li><code>SET NULL</code>：如果父表中的一行被删除或更新，该表中匹配行的值设置为 <code>NULL</code>。</li><li><code>SET DEFAULT</code>: 如果父表中的一行被删除或更新，该表中匹配行的值设置为默认值。</li></ul></li></ul><p>让我们看一下 <code>city</code> 表定义的外键约束：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">\\d city</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">                                           Table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">public.city</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">   Column    |            </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Type</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">             | Collation | Nullable |                </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">Default</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">-------------+-----------------------------+-----------+----------+---------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city_id     | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">integer</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">                     |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | nextval(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">city_city_id_seq</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">::regclass)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city        | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">character varying</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">50</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)       |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country_id  | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">smallint</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">                    |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> last_update | </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">timestamp without time zone</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |           | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">not null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">now</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">()</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Indexes:</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">city_pkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, btree (city_id)</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">idx_fk_country_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> btree (country_id)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Foreign</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> constraints:</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">city_country_id_fkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (country_id) </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country(country_id) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> CASCADE </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Referenced </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">by</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">:</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    TABLE</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">address</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CONSTRAINT</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">address_city_id_fkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (city_id) </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city(city_id) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> CASCADE </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Triggers:</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">    last_updated </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">BEFORE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> ON</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> city </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FOR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> EACH </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ROW</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXECUTE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FUNCTION</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> last_updated</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">()</span></span></code></pre></div><p>注意其中外键的部分：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">Foreign</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">-</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> constraints:</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">city_country_id_fkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (country_id) </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> country(country_id) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> CASCADE </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span></code></pre></div><h3 id="添加外键语法" tabindex="-1">添加外键语法 <a class="header-anchor" href="#添加外键语法" aria-label="Permalink to &quot;添加外键语法&quot;">​</a></h3><p>如果建表的时候没有定义外键，你也可以后来通过以下语法添加外键：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> child_table_name</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> [CONSTRAINT foreign_key_name]</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (column)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> parent_table_name (column)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ...</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> ...</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>这里：</p><ul><li>使用 <a href="./修改表.html"><code>ALTER TABLE</code></a> 语句修改表的定义。</li><li>使用 <code>ADD [CONSTRAINT foreign_key_name]</code> 添加一个名为 <code>foreign_key_name</code> 的约束。<code>[CONSTRAINT foreign_key_name]</code> 是可选的。</li><li>使用 <code>FOREIGN KEY (column)) REFERENCES parent_table_name (column)</code> 定义了外键。</li></ul><h3 id="删除外键语法" tabindex="-1">删除外键语法 <a class="header-anchor" href="#删除外键语法" aria-label="Permalink to &quot;删除外键语法&quot;">​</a></h3><p>要删除表上外键，可以采用下面的语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> constraint_name;</span></span></code></pre></div><p>这里：</p><ul><li>使用 <code>ALTER TABLE</code> 语句修改表的定义。</li><li><code>DROP CONSTRAINT</code> 后面指定约束名。它可以通过名字删除任何约束，并不仅仅是外键。</li></ul><h2 id="postgresql-foreign-key-实例" tabindex="-1">PostgreSQL FOREIGN KEY 实例 <a class="header-anchor" href="#postgresql-foreign-key-实例" aria-label="Permalink to &quot;PostgreSQL FOREIGN KEY 实例&quot;">​</a></h2><p>以下实例将在 <code>testdb</code> 数据库中创建 <code>users</code> 和 <code>user_hobbies</code> 两个表。其中，<code>user_hobbies</code> 表中使用外键引用 <code>users</code> 表。下面先创建 <code>users</code> 表，<code>user_hobbies</code> 表将在后面的实例中根据各自的情况再创建。请按照如下步骤执行：</p><ol><li><p>使用 <code>postgres</code> 用户登录 PostgreSQL 数据库：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">[</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">~</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">]</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> psql -U postgres</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">psql</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (14.4)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">Type</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">help</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> for</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> help.</span></span></code></pre></div><p>注意：您也可以使用其他任何具有相应的数据库权限的用户登录。</p></li><li><p>使用以下语句连接 <code>testdb</code> 数据库：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">\\c testdb</span></span></code></pre></div><p>如果还未<a href="./创建数据库.html">创建数据库</a>，请先运行如下语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> DATABASE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> testdb</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div></li><li><p>使用以下语句创建 <code>users</code> 表：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> users</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">  name</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div></li></ol><p>至此，我们创建了 <code>users</code> 表。</p><h3 id="cascade-策略实例" tabindex="-1">CASCADE 策略实例 <a class="header-anchor" href="#cascade-策略实例" aria-label="Permalink to &quot;CASCADE 策略实例&quot;">​</a></h3><p>如果外键的 <code>ON DELETE</code> 和 <code>ON UPDATE</code> 使用了 <code>CASCADE</code> 策略：</p><ul><li>当父表的行被删除的时候，子表中匹配的行也会被删除。</li><li>当父表的行的键值更新的时候，子表中匹配的行的字段也会被更新。</li></ul><p>使用以下 SQL 创建 <code>user_hobbies</code> 表，它的外键采用 <code>CASCADE</code> 策略。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> IF</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> user_hobbies</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    ON DELETE CASCADE</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> CASCADE</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>向两个表中插入数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies (hobby_id, user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Swimming</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id |  hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Football</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Swimming</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>让我们看一下对父表进行 <code>UPDATE</code> 和 <code>DELETE</code> 操作引起的子表的关联操作：</p><ul><li><p>对父表进行 <code>UPDATE</code> 操作</p><p>我们将父表 <code>users</code> 中的键 <code>user_id</code> 的值从 <code>1</code> 修改为 <code>100</code>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SET</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 100</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id |  hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |     </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">100</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Football</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |     </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">100</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Swimming</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>我们发现，<code>user_hobbies</code> 表中与 <code>users</code> 表中 <code>user_id</code> 列中的 <code>1</code> 被自动修改为 <code>100</code>。</p></li><li><p>对父表进行 <code>DELETE</code> 操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 100</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id | hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+-------</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">0</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>我们发现，<code>user_hobbies</code> 表中与 <code>users</code> 表中 <code>user_id = 100</code> 的那些行都被删除了。</p></li></ul><h3 id="restrict-策略" tabindex="-1">RESTRICT 策略 <a class="header-anchor" href="#restrict-策略" aria-label="Permalink to &quot;RESTRICT 策略&quot;">​</a></h3><p>如果外键的 <code>ON DELETE</code> 和 <code>ON UPDATE</code> 使用了 <code>RESTRICT</code> 策略：</p><ul><li>PostgreSQL 禁止删除父表中与子表匹配的行。</li><li>PostgreSQL 禁止删除父表中与子表匹配的行的键的值。</li></ul><p>使用以下 SQL 创建 <code>user_hobbies</code> 表，它的外键采用 <code>RESTRICT</code> 策略。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> IF</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> user_hobbies</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>向两个表中插入数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies (hobby_id, user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Swimming</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id |  hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Football</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |       </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Swimming</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>让我们看一下对父表进行 <code>UPDATE</code> 和 <code>DELETE</code> 操作的结果：</p><ul><li><p>对父表进行 <code>UPDATE</code> 操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SET</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 100</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>PostgreSQL 服务器返回了如下的错误：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">update</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> or</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> delete</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> on</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">foreign key</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies_user_id_fkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> on</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">is</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> still referenced </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">from</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">.</span></span></code></pre></div></li><li><p>对父表进行 <code>DELETE</code> 操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>PostgreSQL 服务器返回了如下的错误：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">update</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> or</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> delete</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> on</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">users</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">foreign key</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies_user_id_fkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> on</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">is</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> still referenced </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">from</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> table</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">user_hobbies</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">.</span></span></code></pre></div></li></ul><h3 id="set-null-策略" tabindex="-1">SET NULL 策略 <a class="header-anchor" href="#set-null-策略" aria-label="Permalink to &quot;SET NULL 策略&quot;">​</a></h3><p>如果外键的 <code>ON DELETE</code> 和 <code>ON UPDATE</code> 使用了 <code>SET NULL</code> 策略：</p><ul><li>当父表的行被删除的时候，子表中匹配的行的列的值被设置为 <code>NULL</code>。</li><li>当父表的行的键值被更新的时候，子表中匹配的行的列的值被设置为 <code>NULL</code>。</li></ul><p>使用以下 SQL 创建 <code>user_hobbies</code> 表，它的外键采用 <code>SET NULL</code> 策略。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DROP</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> IF</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> EXISTS</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> user_hobbies</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  user_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  hobby </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (hobby_id),</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> fk_user</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    ON DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> SET</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NULL</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> SET</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> NULL</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>向两个表中插入数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies (hobby_id, user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Swimming</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>让我们看一下对父表进行 <code>UPDATE</code> 和 <code>DELETE</code> 操作引起的子表的关联操作：</p><ul><li><p>对父表进行 <code>UPDATE</code> 操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SET</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 100</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> hobby_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> user_id</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">  hobby</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">        1</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">  &lt;</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">&gt; </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">|</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Football</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">        2</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">  &lt;</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">null</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">&gt; </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">|</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> Swimming</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">2</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> rows</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">)</span></span></code></pre></div><p>更新父表中的 <code>user_id</code> 列的值后，<code>user_hobbies</code> 表中那些对应的行的 <code>user_id</code> 列的值被设置为 <code>NULL</code>。</p></li><li><p>对父表进行 <code>DELETE</code> 操作</p><p>由于上面实例将表的数据修改了，我们重新初始化两个表的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies;</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users (user_id, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">name</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tim</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_hobbies (hobby_id, user_id, hobby)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Football</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">), (</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Swimming</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">DELETE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> FROM</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> users</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> user_id </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> 1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><p>此时 <code>user_hobbies</code> 表中的数据：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> hobby_id | user_id |  hobby</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-dark:#676E95;--shiki-dark-font-style:italic;">----------+---------+----------</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        1</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |  </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&lt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Football</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">        2</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> |  </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&lt;</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">null</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&gt;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> | Swimming</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">2</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> rows</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">)</span></span></code></pre></div><p>删除父表中的 <code>user_id</code> 列的值后，<code>user_hobbies</code> 表中那些对应的行的 <code>user_id</code> 列的值被设置为 <code>NULL</code>。</p></li></ul><h2 id="自引用外键" tabindex="-1">自引用外键 <a class="header-anchor" href="#自引用外键" aria-label="Permalink to &quot;自引用外键&quot;">​</a></h2><p>有时，子表和父表可能是同一个表。这种表中的外键被称为自引用外键。</p><p>通常，自引用外键定义在表示树形数据结构的表中。比如一个代表分类的表：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> category</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  category_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  category_name </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">45</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">),</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  parent_category_id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">INTEGER</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">  CONSTRAINT</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> fk_category </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">FOREIGN KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (parent_category_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    REFERENCES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> category (category_id)</span></span>
<span class="line"><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">    ON DELETE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> RESTRICT</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">    ON</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UPDATE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> CASCADE</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>在这个表中，<code>parent_category_id</code> 列是一个外键。它引用了 <code>category</code> 表的 <code>category_id</code> 列。</p><p>这个表实现了一个无限层级的分类树。一个分类可以有多个子分类，一个分类可以有 0 个或者 1 个父类；</p><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>在本文中，我们介绍了什么是外键、外键的规则以及如何在 PostgreSQL 中使用外键。以下是本文的要点内容：</p><ul><li>外键用来定义两个实体之间的约束关系。外键对保证数据的完整性很有帮助。</li><li>定义外键的表被称作子表，被外键引用的表被称作父表。</li><li>外键引用的是父表的主键或者唯一键值列。</li><li><code>ALTER TABLE ... ADD FOREIGN KEY ...</code> 语句可以用来添加外键。</li><li><code>ALTER TABLE ... DROP CONSTRAINT ...</code> 语句可以用来删除外键。</li><li>自引用外键引用的是当前表自身。这可以实现树形数据结构。</li></ul>`,82)])])}const g=i(k,[["render",t]]);export{D as __pageData,g as default};
