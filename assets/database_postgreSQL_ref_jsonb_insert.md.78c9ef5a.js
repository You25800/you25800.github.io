import{_ as s,o as a,c as n,R as o}from"./chunks/framework.318fa179.js";const d=JSON.parse('{"title":"PostgreSQL jsonb_insert() 函数","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/ref/jsonb_insert.md","filePath":"database/postgreSQL/ref/jsonb_insert.md","lastUpdated":1690180485000}'),l={name:"database/postgreSQL/ref/jsonb_insert.md"},p=o(`<h1 id="postgresql-jsonb-insert-函数" tabindex="-1">PostgreSQL jsonb_insert() 函数 <a class="header-anchor" href="#postgresql-jsonb-insert-函数" aria-label="Permalink to &quot;PostgreSQL jsonb\\_insert() 函数&quot;">​</a></h1><p>PostgreSQL <code>jsonb_insert()</code> 函数将一个新值插入到一个给定的 JSONB 值中通过路径指定的位置。</p><h2 id="jsonb-insert-语法" tabindex="-1"><code>jsonb_insert()</code> 语法 <a class="header-anchor" href="#jsonb-insert-语法" aria-label="Permalink to &quot;\`jsonb_insert()\` 语法&quot;">​</a></h2><p>这是 PostgreSQL <code>jsonb_insert()</code> 函数的语法：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">jsonb_insert(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">target</span><span style="color:#A6ACCD;"> JSONB, </span><span style="color:#C792EA;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">TEXT</span><span style="color:#A6ACCD;">[], new_value JSONB[, insert_after BOOLEAN]</span></span>
<span class="line"><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> JSONB</span></span></code></pre></div><h3 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-label="Permalink to &quot;参数&quot;">​</a></h3><ul><li><p><em><code>target</code></em></p><p>必需的。 要插入新值的 JSONB 值。</p></li><li><p><em><code>path</code></em></p><p>必需的。 一个文本数组，指示了新值插入的位置。数组中靠前的路径，应该包含数组中靠后的路径。</p></li><li><p><em><code>new_value</code></em></p><p>必需的。 要插入的新值。</p></li><li><p><em><code>insert_after</code></em></p><p>可选的。 它指示是否插入到指定的位置之后。默认是值 <code>false</code>。</p></li></ul><h3 id="返回值" tabindex="-1">返回值 <a class="header-anchor" href="#返回值" aria-label="Permalink to &quot;返回值&quot;">​</a></h3><p>PostgreSQL <code>jsonb_insert()</code> 函数返回给定的 JSONB 值，其中在指定的路径上插入了指定的新值。</p><p>如果路径指向一个对象字段，只有当对象中不存在此字段时新值才会被插入。</p><p>如果路径指向的是一个数组元素，若 <code>insert_after</code> 为 false（默认值）， 则新值默认插入到指定的元素之前，否则新值插入到指定的元素之后。</p><p>如果 JSONB 值中未找到指定的路径，则 JSON 值不会被修改，并原样返回。</p><h2 id="jsonb-insert-示例" tabindex="-1"><code>jsonb_insert()</code> 示例 <a class="header-anchor" href="#jsonb-insert-示例" aria-label="Permalink to &quot;\`jsonb_insert()\` 示例&quot;">​</a></h2><p>下面的示例展示了如何使用 PostgreSQL <code>jsonb_insert()</code> 函数向一个 JSON 对象中插入一个键。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> jsonb_insert(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;x&quot;: 1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{y}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">jsonb_insert</span></span>
<span class="line"><span style="color:#FFCB6B;">------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">&quot;x&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}</span></span></code></pre></div><p>下面的示例展示了如何使用 PostgreSQL <code>jsonb_insert()</code> 函数向一个 JSON 数组中插入一个新元素。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> jsonb_insert(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;x&quot;: 1, &quot;y&quot;: [1, 2]}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{y, 0}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">jsonb_insert</span></span>
<span class="line"><span style="color:#FFCB6B;">--------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">&quot;x&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> [0, </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">]}</span></span></code></pre></div><p>这里， 数组 <code>{y, 0}</code> 表示先找到对象中的 y 字段，再找到 y 字段中的索引为 0 的位置，然后在此位置插入新元素 0。</p><p>当然，我们可以将新元素插入到指定的位置之后：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> jsonb_insert(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;x&quot;: 1, &quot;y&quot;: [1, 2]}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{y, 0}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, true);</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">jsonb_insert</span></span>
<span class="line"><span style="color:#FFCB6B;">--------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">&quot;x&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">y</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> [1, </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">]}</span></span></code></pre></div><p>您不能替换一个对象中已经存在的键，比如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> jsonb_insert(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;x&quot;: 1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{x}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><p>这将会引发一个错误：</p><p>错误: 不能替换已经存在的键 提示: 尝试使用 jsonb_set 来替换键值。</p>`,27),e=[p];function t(c,r,C,y,i,D){return a(),n("div",null,e)}const A=s(l,[["render",t]]);export{d as __pageData,A as default};
