import{_ as i,c as a,o as e,b3 as h}from"./chunks/framework.CatkIGlB.js";const A=JSON.parse('{"title":"PostgreSQL 唯一索引","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/index/唯一索引.md","filePath":"database/postgreSQL/index/唯一索引.md","lastUpdated":1690289709000}'),t={name:"database/postgreSQL/index/唯一索引.md"};function n(l,s,p,k,d,r){return e(),a("div",null,[...s[0]||(s[0]=[h(`<h1 id="postgresql-唯一索引" tabindex="-1">PostgreSQL 唯一索引 <a class="header-anchor" href="#postgresql-唯一索引" aria-label="Permalink to &quot;PostgreSQL 唯一索引&quot;">​</a></h1><p>本文介绍在 PostgreSQL 中如何创建唯一索引以确保一列或多列中值的唯一性。</p><p>PostgreSQL <code>UNIQUE</code> 索引用于强制一列或多列中值的唯一性。</p><h2 id="postgresql-unique-索引介绍" tabindex="-1">PostgreSQL <code>UNIQUE</code> 索引介绍 <a class="header-anchor" href="#postgresql-unique-索引介绍" aria-label="Permalink to &quot;PostgreSQL \`UNIQUE\` 索引介绍&quot;">​</a></h2><p>只有<a href="./索引类型.html">索引类型</a>为 B-Tree 的索引可以声明为唯一索引。 要创建 <code>UNIQUE</code> 索引，您可以使用以下语法：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UNIQUE INDEX</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> index_name</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> table_name(column_name, [...]);</span></span></code></pre></div><p><code>UNIQUE</code> 关键字用于将索引声明为唯一索引。</p><p>如果一个列被定义为唯一索引，那么该列不能存储具有相同的值。</p><p>如果两列或更多列被定义为唯一索引，则这些列中的组合值不能重复。</p><p>但是，您可以在具有 <code>UNIQUE</code> 索引的列中使用多个 <code>NULL</code> 值 。</p><p>当您为表定义<a href="/database/postgreSQL/databaseAndTable/主键.html">主键</a>或<a href="/database/postgreSQL/databaseAndTable/唯一约束.html">唯一约束</a>时，PostgreSQL 会自动创建相应的 <code>UNIQUE</code> 索引。</p><h2 id="postgresql-unique-索引示例" tabindex="-1">PostgreSQL <code>UNIQUE</code> 索引示例 <a class="header-anchor" href="#postgresql-unique-索引示例" aria-label="Permalink to &quot;PostgreSQL \`UNIQUE\` 索引示例&quot;">​</a></h2><p>以下语句<a href="/database/postgreSQL/databaseAndTable/创建表.html">创建一个名为 <code>staff</code> 的表</a>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> staff</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  id </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">SERIAL</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> PRIMARY KEY</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  first_name </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">255</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  last_name </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">255</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">NOT NULL</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  email </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">255</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">UNIQUE</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>在这个语句中， <code>id</code> 是<a href="/database/postgreSQL/databaseAndTable/主键.html">主键</a>列， <code>email</code> 列有<a href="/database/postgreSQL/databaseAndTable/唯一约束.html">唯一约束</a>，因此，PostgreSQL 创建了两个 <code>UNIQUE</code> 索引，每个列一个。</p><p>要显示 <code>staff</code> 表的索引，请使用以下语句：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  tablename,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  indexname,</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  indexdef</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">FROM</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  pg_indexes</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">WHERE</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">  tablename </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">staff</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> tablename</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">    indexname</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">    |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">                                indexdef</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">-----------+-----------------+-------------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> staff</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">     |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> staff_pkey</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">      |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> CREATE</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> UNIQUE</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> INDEX</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> staff_pkey</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> ON</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> public.staff</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> USING</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> btree</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (id)</span></span>
<span class="line"><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> staff</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">     |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> staff_email_key</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> |</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;"> CREATE</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> UNIQUE</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> INDEX</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> staff_email_key</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> ON</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> public.staff</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> USING</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> btree</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (email)</span></span>
<span class="line"><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">(</span><span style="--shiki-light:#E2931D;--shiki-dark:#FFCB6B;">2</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;"> rows</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">)</span></span></code></pre></div><h3 id="postgresql-unique-索引-–-单列示例" tabindex="-1">PostgreSQL <code>UNIQUE</code> 索引 – 单列示例 <a class="header-anchor" href="#postgresql-unique-索引-–-单列示例" aria-label="Permalink to &quot;PostgreSQL \`UNIQUE\` 索引 – 单列示例&quot;">​</a></h3><p>以下语句将 <code>mobile_phone</code> 列添加到 <code>staff</code> 表中：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> mobile_phone </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">20</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>为确保所有员工的手机号码都是不同的，您可以为该 <code>mobile_phone</code> 列定义一个 <code>UNIQUE</code> 索引，如下所示：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UNIQUE INDEX</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> idx_staff_mobile_phone</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(mobile_phone);</span></span></code></pre></div><p>让我们来测试一下。</p><p>首先，在 <code>staff</code> 表中<a href="/database/postgreSQL/base/INSTER.html">插入一个新行</a>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(first_name, last_name, email, mobile_phone)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Adam</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Z</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">adam@sqliz.com</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">13333333333</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>其次，尝试插入具有相同电话号码的另一行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(first_name, last_name, email, mobile_phone)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Jack</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">W</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">jack@sqliz.com</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">13333333333</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>由于手机号重复，PostgreSQL 出现如下错误：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  duplicate </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">key</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> value</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">unique</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">idx_staff_mobile_phone</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (mobile_phone)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">13333333333</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) already </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">exists</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">.</span></span></code></pre></div><h3 id="postgresql-unique-索引-–-多列示例" tabindex="-1">PostgreSQL <code>UNIQUE</code> 索引 – 多列示例 <a class="header-anchor" href="#postgresql-unique-索引-–-多列示例" aria-label="Permalink to &quot;PostgreSQL \`UNIQUE\` 索引 – 多列示例&quot;">​</a></h3><p>以下语句将<a href="/database/postgreSQL/dataType/添加列.html">添加两个新列</a> <code>work_phone</code> 和 <code>extension</code> 到 <code>staff</code> 表中：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ALTER</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> TABLE</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> work_phone </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">20</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">),</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ADD</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> extension </span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;">VARCHAR</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">5</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>多个员工可以共享同一个工作电话号码。但是，它们不能具有相同的分机号码。要强制执行此规则，您可以在 <code>work_phone</code> 和 <code>extension</code> 列上定义 <code>UNIQUE</code> 索引：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">CREATE</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> UNIQUE INDEX</span><span style="--shiki-light:#6182B8;--shiki-dark:#82AAFF;"> idx_staff_workphone</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">ON</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(work_phone, extension);</span></span></code></pre></div><p>要测试这个索引，首先在 <code>staff</code> 表中插入一行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(first_name, last_name, work_phone, extension)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Lily</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Bush</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">1234567</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">3564</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>其次，插入另一个具有相同工作电话号码但分机号不同的员工：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(first_name, last_name, work_phone, extension)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Joan</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Doe</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">1234567</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">3565</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>该语句有效，因为 <code>work_phone</code> 和 <code>extension</code> 列中的值组合是唯一的。</p><p>第三，尝试在 <code>staff</code> 表中的 <code>work_phone</code> 和 <code>extension</code> 列中插入具有相同值的行：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">INSERT INTO</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> staff(first_name, last_name, work_phone, extension)</span></span>
<span class="line"><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">VALUES</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Tommy</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">Stark</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">1234567</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">,</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">3565</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&#39;</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">);</span></span></code></pre></div><p>PostgreSQL 发出以下错误：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes material-theme-lighter material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">ERROR:  duplicate </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">key</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;"> value</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> violates </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">unique</span><span style="--shiki-light:#9C3EDA;--shiki-dark:#C792EA;"> constraint</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#91B859;--shiki-dark:#C3E88D;">idx_staff_workphone</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">DETAIL:  </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">Key</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;"> (work_phone, extension)</span><span style="--shiki-light:#39ADB5;--shiki-dark:#89DDFF;">=</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">(</span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">1234567</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">, </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">3565</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">) already </span><span style="--shiki-light:#F76D47;--shiki-dark:#F78C6C;">exists</span><span style="--shiki-light:#90A4AE;--shiki-dark:#BABED8;">.</span></span></code></pre></div><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>本文讨论了 PostgreSQL <code>UNIQUE</code> 索引的用法， <code>UNIQUE</code> 索引用于强制一列或多列中值的唯一性。</p>`,46)])])}const g=i(t,[["render",n]]);export{A as __pageData,g as default};
